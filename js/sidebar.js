$(document).ready(function(){var t=window.CONFIG,e=window.Stun,s=t.sidebar&&t.sidebar.tocMaxDepth||4,i="h1,h2,h3,h4,h5,h6,".slice(0,3*s).slice(0,-1);var o=null,a=null,n=!1;function r(){var t=$(".post-body"),e=$(".sidebar-toc li"),s=t.find(i),r=s.first();if(s.each(function(){this.getBoundingClientRect().top<=5&&(o=this.getAttribute("id"))}),t[0]&&r[0]&&r.offset().top-$(window).scrollTop()>0)n||(e.removeClass("active current"),n=!0);else if(o!==a){var d=$('.sidebar-toc a[href="#'+o+'"]');d[0]&&e.removeClass("active current"),d.parents("li").addClass("active"),d.parent().addClass("current"),a=o}}var d=!1;function c(){var t=$(".sidebar-toc").height();if(!($(".sidebar-toc > div").height()<=t)){var e=$(".sidebar-toc"),s=$(".sidebar-toc .current a");if(s[0]&&e[0]){var i=s.offset().top-e.offset().top;d=i>t||i<0}d&&s.velocity("stop").velocity("scroll",{container:e,offset:-t/2,duration:500,easing:"easeOutQuart"})}}var l=0;function f(){var t=$(".sidebar-inner");document.getElementById("main").getBoundingClientRect().top<l?t.addClass("sticky"):t.removeClass("sticky")}function u(){if(0!==$("#is-post").length){var e=$(".content"),s=e.offset().top,i=0,o=!1,a=0;t.post_widget&&t.post_widget.end_text&&(o=!0),i=o?$(".post-end").offset().top-s+$(".post-end").outerHeight():$(".post-footer").offset().top-s;var n=$(window).height(),r=0;0!==e.length&&(r=parseInt(-1*e[0].getBoundingClientRect().top)+n);var d=Number($(".sidebar-reading-info-num").text());i=parseInt(Math.abs(i)),0===(a=(a=parseInt(r/i*100))>100?100:a<0?0:a)&&0===d||100===a&&100===d||($(".sidebar-reading-info-num").text(a),$(".sidebar-reading-line").css("transform","translateX("+(a-100)+"%)"))}}t.sidebar&&t.sidebar.offsetTop&&(l=parseInt(t.sidebar.offsetTop)),r(),f(),c(),u(),$(window).on("scroll",function(){f()}),$(window).on("scroll",e.utils.throttle(function(){r(),c(),u()},150)),e.utils.pjaxReloadSidebar=function(){var t=$(".sidebar-nav-toc"),e=$(".sidebar-nav-ov"),s=$(".sidebar-toc"),o=$(".sidebar-ov");t.on("click",function(){$(this).hasClass("current")||(t.addClass("current"),e.removeClass("current"),s.css("display","block"),s.velocity("stop").velocity("fadeIn"),o.css("display","none"),o.velocity("stop").velocity("fadeOut"))}),e.on("click",function(){$(this).hasClass("current")||(e.addClass("current"),t.removeClass("current"),s.css("display","none"),s.velocity("stop").velocity("fadeOut"),o.css("display","block"),o.velocity("stop").velocity("fadeIn"))}),$(".post-body").find(i)[0]||($(".sidebar-nav").addClass("hide"),$(".sidebar-toc").addClass("hide"),$(".sidebar-ov").removeClass("hide"))},e.utils.pjaxReloadSidebar()});