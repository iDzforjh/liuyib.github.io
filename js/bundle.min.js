Stun.utils=Stun.$u={debounce:function(t,e,i){var n;return function(){var o=this,a=arguments;if(n&&clearTimeout(n),i){var r=!n;n=setTimeout(function(){n=null},e),r&&t.apply(o,a)}else n=setTimeout(function(){t.apply(o,a)},e)}},throttle:function(t,e,i){var n,o,a,r=0;i||(i={});var s=function(){r=!1===i.leading?0:(new Date).getTime(),n=null,t.apply(o,a),n||(o=a=null)};return function(){var c=(new Date).getTime();r||!1!==i.leading||(r=c);var l=e-(c-r);o=this,a=arguments,l<=0||l>e?(n&&(clearTimeout(n),n=null),r=c,t.apply(o,a),n||(o=a=null)):n||!1===i.trailing||(n=setTimeout(s,l))}},hasMobileUA:function(){var t=window.navigator.userAgent;return/iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g.test(t)},isTablet:function(){return window.screen.width>767&&window.screen.width<992&&this.hasMobileUA()},isMobile:function(){return window.screen.width<767&&this.hasMobileUA()},isDesktop:function(){return!this.isTablet()&&!this.isMobile()},codeToKeyCode:function(t){return{ArrowLeft:37,ArrowRight:39,Escape:27,Enter:13}[t]},popAlert:function(t,e,i){if(!$(".stun-alert")[0]){var n=$('<div class="stun-message"><div class="stun-alert stun-alert-'+t+'"><i class="stun-alert-icon fa fa-'+{success:"check-circle",info:"exclamation-circle",warning:"exclamation-circle",error:"times-circle"}[t]+'"></i><span class="stun-alert-description">'+e+"</span></div></div>");$("body").append(n)}$(document).ready(function(){$(".stun-alert").velocity("stop").velocity("transition.slideDownBigIn",{duration:300}).velocity("reverse",{delay:1e3*i||5e3,duration:260,complete:function(){$(".stun-alert").css("display","none")}})})},copyText:function(t){try{var e=window.getSelection(),i=document.createRange();i.selectNodeContents(t),e.removeAllRanges(),e.addRange(i);var n=e.toString(),o=document.createElement("input");if(o.style.display="none",o.setAttribute("readonly","readonly"),o.setAttribute("value",n),document.body.appendChild(o),o.setSelectionRange(0,-1),document.execCommand("copy"))return document.execCommand("copy"),document.body.removeChild(o),!0;document.body.removeChild(o)}catch(t){return!1}},initTocDisplay:function(){$(".post-body").find("h1,h2,h3,h4,h5,h6")[0]||($(".sidebar-nav").addClass("hide"),$(".sidebar-toc").addClass("hide"),$(".sidebar-overview").removeClass("hide"))},wrapImageWithFancyBox:function(){$(".content img").not(":hidden").each(function(){var t=$(this),e=t.attr("title")||t.attr("alt"),i=t.parent("a"),n=["data-src","data-original","src"],o="";if(!i[0]){for(var a=0;a<n.length;a++)if(t.attr(n[a])){o=t.attr(n[a]);break}i=t.wrap('<a class="fancybox" href="'+o+'" itemscope itemtype="http://schema.org/ImageObject" itemprop="url"></a>').parent("a"),t.is(".gallery img")?i.attr("data-fancybox","gallery"):i.attr("data-fancybox","default")}e&&i.attr("title",e).attr("data-caption",e)}),$().fancybox({selector:"[data-fancybox]",loop:!0,transitionEffect:"slide",hash:!1,buttons:["share","slideShow","fullScreen","download","thumbs","close"]})},showImageToWaterfall:function(){var t=CONFIG.gallery_waterfall,e=parseInt(t.col_width),i=parseInt(t.gap_x);this.waitAllImageLoad(".gallery img",function(){$(".gallery").masonry({itemSelector:".gallery-image",columnWidth:e,percentPosition:!0,gutter:i,transitionDuration:0})})},lazyLoadImage:function(){$("img.lazyload").lazyload()},addIconToExternalLink:function(t){if($(t)[0]){var e=$('<span class="external-link"></span>'),i=$('<i class="fa fa-'+CONFIG.external_link.icon.name+'"></i>');$(t).find('a[target="_blank"]').wrap(e).parent(".external-link").append(i)}},registerHotkeyToSwitchPost:function(){var t=this;$(document).on("keydown",function(e){var i=e.keyCode===t.codeToKeyCode("ArrowLeft"),n=e.keyCode===t.codeToKeyCode("ArrowRight");if(e.ctrlKey&&i){var o=$(".article-prev").find("a")[0];o&&o.click()}else if(e.ctrlKey&&n){var a=$(".article-next").find("a")[0];a&&a.click()}})},registerShowReward:function(){$(".reward-button").on("click",function(){var t=$(".reward-qr-wrapper");t.is(":visible")?t.css("display","none"):t.velocity("stop").velocity("transition.slideDownBigIn",{duration:300})})},registerClickToZoomImage:function(){$(".content img").not(":hidden").each(function(){$(this).addClass("zoom-image")});var t=$('<div class="zoom-image-mask"></div>'),e=$("<img>"),i=!1;function n(){e.velocity("reverse"),t.velocity("reverse",{complete:function(){$(".zoom-image.show").remove(),$(".zoom-image-mask").remove(),$(".zoom-image").removeClass("hide")}})}$(window).on("scroll",function(){i&&(i=!1,setTimeout(n,200))}),$(document).on("click",function(){n()}),$(".zoom-image").on("click",function(n){n.stopPropagation(),i=!0;var o=this.getBoundingClientRect(),a=$(this).width(),r=$(this).height(),s=$(this).outerWidth(),c=$(this).outerHeight(),l=$(window).width(),d=$(window).height(),u=l/a,p=d/r,h=(u<p?u:p)||1,f=l/2-(o.x+s/2),m=d/2-(o.y+c/2);e.attr("class",this.className),e.attr("src",this.src),e.addClass("show"),e.css({left:$(this).offset().left+(s-a)/2,top:$(this).offset().top+(c-r)/2,width:a,height:r}),$(this).addClass("hide"),$("body").append(t).append(e),t.velocity({opacity:1}),e.velocity({translateX:f,translateY:m,scale:h},{duration:300,easing:[.2,0,.2,1]})})},addCopyButtonToCopyright:function(){$("figure.highlight").each(function(){if(!$(this).find("figcaption")[0]){var t=$(this).attr("class").split(/\s/).filter(function(t){return"highlight"!==t});$('<figcaption class="custom"><div class="custom-lang">'+t+"</div></figcaption>").insertBefore($(this).children().first())}});var t=$('<div class="copy-button" data-popover='+CONFIG.prompt.copy_button+' data-popover-pos="up"><i class="fa fa-clipboard"></i></div>');$("figure.highlight figcaption, .post-copyright").append(t)},registerCopyEvent:function(){$(".copy-button").on("click",function(){var t=null,e=$(this).parents("figure.highlight").find("td.code")[0];t=e||$(this).parent()[0],Stun.utils.copyText(t)?Stun.utils.popAlert("success",CONFIG.prompt.copy_success):Stun.utils.popAlert("error",CONFIG.prompt.copy_error)})},waitAllImageLoad:function(t,e){var i=[];$(t).each(function(){var t=$.Deferred();$(this).bind("load",function(){t.resolve()}),this.complete&&setTimeout(function(){t.resolve()},500),i.push(t)}),$.when.apply(null,i).then(e)}};$(document).ready(function(){CONFIG.shortcuts.switch_post&&Stun.utils.registerHotkeyToSwitchPost(),CONFIG.external_link&&Stun.utils.addIconToExternalLink("#footer"),Stun.utils.pjaxReloadBoot=function(){if(this.initTocDisplay(),this.addCopyButtonToCopyright(),this.registerCopyEvent(),CONFIG.reward&&this.registerShowReward(),CONFIG.gallery_waterfall&&this.showImageToWaterfall(),CONFIG.lazyload&&this.lazyLoadImage(),CONFIG.external_link){this.addIconToExternalLink(".archive-inner, .post-title")}CONFIG.fancybox?this.wrapImageWithFancyBox():CONFIG.zoom_image&&this.registerClickToZoomImage()},Stun.utils.pjaxReloadBoot()});$(document).ready(function(){var o=0,e=!1,n=!0;function a(){var a=$(window).scrollTop(),l=a-o;if(0===a)$(".header-nav").removeClass("fixed"),$(".header-nav").removeClass("slider-up"),$(".header-nav").addClass("slider-down"),e=!1;else{e||($(".header-nav").addClass("fixed"),e=!0);Math.abs(l)>5&&(n&&l>0?($(".header-nav").removeClass("slider-down"),$(".header-nav").addClass("slider-up"),n=!1):!n&&l<0&&($(".header-nav").removeClass("slider-up"),$(".header-nav").addClass("slider-down"),n=!0))}o=a}function l(o){$(o).velocity("stop").velocity("scroll",{easing:"easeOutSine"})}var s=!1;a(),function(){function o(){var o=$("#back-top");0!==$(window).scrollTop()?s||(o.addClass("show"),o.removeClass("hide"),s=!0):(o.addClass("hide"),o.removeClass("show"),s=!1)}$(window).on("load",o),$(window).on("scroll",Stun.utils.throttle(function(){o()},500)),$("#back-top").on("click",function(){$("body").velocity("stop").velocity("scroll")})}(),$(window).on("scroll",Stun.utils.throttle(function(){a()},100)),Stun.utils.pjaxReloadScroll=function(){$(".content").find("h1,h2,h3,h4,h5,h6").on("click",function(){l("#"+$(this).attr("id"))}),$(".toc-link").on("click",function(o){o.preventDefault(),l($(this).attr("href"))})},Stun.utils.pjaxReloadScroll()});$(document).ready(function(){var n=$(".header-nav-menu"),e=$(".header-nav-menu .menu-item");$(document).on("click",function(){n.removeClass("show")}),$(".header-nav-menu-icon").on("click",function(e){e.stopPropagation(),n.toggleClass("show")}),e.on("click",function(n){n.stopPropagation()}),e.on("mouseenter",function(){var n=$(this).find(".header-nav-submenu"),e="transition."+(Stun.utils.isDesktop()?"slideUpIn":"slideRightIn");n[0]&&n.velocity("stop").velocity(e,{duration:240})}),e.on("mouseleave",function(){var n=$(this).find(".header-nav-submenu");n[0]&&n.css("display","none")})});$(document).ready(function(){var e=null,t=null,i=!1,n=CONFIG.sidebar.renderTocDepth,s="h1,h2,h3,h4,h5,h6".slice(0,3*n),a=$(".post-body"),o=$(".sidebar-toc li");function r(){var n=a.find(s),r=n.first();if(n.each(function(){this.getBoundingClientRect().top<0&&(e=this.getAttribute("id"))}),a[0]&&r[0]&&r.offset().top-$(window).scrollTop()>0)i||(o.removeClass("active current"),i=!0);else if(i=!1,e!==t){var c=$('.sidebar-toc a[href="#'+e+'"]');c[0]&&o.removeClass("active current"),c.parents("li").addClass("active"),c.parent().addClass("current"),t=e}}6!==n&&(s=s.slice(0,-1));var c=!1;function l(){var e=$(".sidebar-toc").height();if(!($(".sidebar-toc .toc").height()<=e)){var t=$(".sidebar-toc"),i=$(".sidebar-toc .current a");if(i[0]&&t[0]){var n=i.offset().top-t.offset().top;c=n>e||n<0}c&&i.velocity("stop").velocity("scroll",{container:t,offset:-e/2,duration:500,easing:"easeOutQuart"})}}var d=parseInt(CONFIG.sidebar.offsetTop),u=!1;function v(){var e=$(".main-inner")[0];e&&(e.getBoundingClientRect().top<d?u||($(".sidebar-inner").addClass("sticky"),u=!0):u&&($(".sidebar-inner").removeClass("sticky"),u=!1))}function f(){var e=$(".content"),t=e[0]&&-1*e[0].getBoundingClientRect().top||0,i=parseInt(t/Math.abs(e.height()-$(window).height())*100);i=i>100?100:i<0?0:i,$(".sidebar-progress-number").html(i),$(".sidebar-progress-line").css("transform","translateX("+(i-100)+"%)")}r(),v(),l(),f(),$(window).on("scroll",function(){v()}),$(window).on("scroll",Stun.utils.throttle(function(){r(),l(),f()},150)),Stun.utils.pjaxReloadSidebar=function(){var e=$(".sidebar-toc"),t=$(".sidebar-overview");$(".sidebar-nav-toc").on("click",function(){$(".sidebar-nav-toc").toggleClass("current"),$(".sidebar-nav-overview").toggleClass("current"),e.css("display","block"),e.velocity("fadeIn"),t.css("display","none"),t.velocity("fadeOut")}),$(".sidebar-nav-overview").on("click",function(){$(".sidebar-nav-toc").toggleClass("current"),$(".sidebar-nav-overview").toggleClass("current"),e.css("display","none"),e.velocity("fadeOut"),t.css("display","block"),t.velocity("fadeIn")})},Stun.utils.pjaxReloadSidebar()});